---
title: "Definition ğŸš§"
---

For special product rules,
the semantics of term automata is invariant under term equivalence.
In other words, term automata are polynomial automatam,
that is, automata whose states are bona-fide polynomials.

```
{-# OPTIONS --guardedness --sized-types #-}
-- {-# OPTIONS --allow-unsolved-metas #-}

open import Preliminaries.Base
open import General.ProductRules
open import Special.ProductRules

module Special.Automata
    (R : CommutativeRing)
    (Î£ : Set)
    (P : ProductRule R)
    (special : Special R P)
    where

open import General.Terms R
open import General.Products R Î£
open import General.Automata R Î£ P

open import Special.Products R Î£

open Product P hiding (_*_; *-cong)
open ProductProperties special

private variable X : Set
```

We show that the semantics of term automata is invariant under the equivalence
generated by axioms of commutative algebras.
We rely on !remoteRef(General)(Automata)(sem-hom).

```
module _ where

    open import General.Series R Î£
    open import Special.Polynomials R as P
        renaming (_â‰ˆ_ to _[â‰ˆ]_)

    theorem :
        âˆ€ (S : TermAut X) (Î± Î² : Term X) â†’
        Î± [â‰ˆ] Î² â†’
        ----------------------------------
        S âŸ¦ Î± âŸ§ â‰ˆ S âŸ¦ Î² âŸ§

    theorem S Î± Î² Î±â‰ˆÎ² = begin
        S âŸ¦ Î± âŸ§
            â‰ˆâŸ¨ sem-hom _ _ âŸ©
        âŸ¦ Î± âŸ§ (S âŸ¦XâŸ§)
            â‰ˆâŸ¨ invariance Î±â‰ˆÎ² âŸ©
        âŸ¦ Î² âŸ§ (S âŸ¦XâŸ§)
            â‰ˆâŸ¨ sem-hom _ _ âŸ¨
        S âŸ¦ Î² âŸ§
        âˆ where open EqS
```

Moreover, we show that the transition relation is also invariant.
In fact this implies the above.

```
module _ where

    open import Special.Polynomials R

    theorem1 :
        âˆ€ (Î” : Subst X X) (Î± Î² : Term X) â†’
        Î± â‰ˆ Î² â†’
        ----------------------------------
        Î” â†‘ Î± â‰ˆ Î” â†‘ Î²

    theorem1 Î” Î± Î² = go where

        go : âˆ€ {Î± Î²} â†’ Î± â‰ˆ Î² â†’ Î” â†‘ Î± â‰ˆ Î” â†‘ Î²

        go â‰ˆ-refl = â‰ˆ-refl
        go (â‰ˆ-sym Î±â‰ˆÎ²) = â‰ˆ-sym (go Î±â‰ˆÎ²)
        go (â‰ˆ-trans Î±â‰ˆÎ² Î²â‰ˆÎ³) = â‰ˆ-trans (go Î±â‰ˆÎ²) (go Î²â‰ˆÎ³)
        go (Â·-cong câ‰ˆd Î±â‰ˆÎ²) = Â·-cong câ‰ˆd (go Î±â‰ˆÎ²)
        go {Î² = Î²} (Â·-one _) = Â·-one (Î” â†‘ Î²)
        go (Â·-+-distrib c p q) = Â·-+-distrib c (Î” â†‘ p) (Î” â†‘ q)
        go (+-Â·-distrib p c d) = +-Â·-distrib (Î” â†‘ p) c d
        go (Â·-*-distrib c p q) =
            begin
                Î” â†‘ ((c Â· p) * q)
                    â‰ˆâŸ¨âŸ©
                [ P ]âŸ¨ c Â· p , c Â· Î” â†‘ p , q , Î” â†‘ q âŸ©
                    â‰¡âŸ¨ subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) âŸ¨
                [ [ P ]âŸ¨ c Â· x , c Â· xâ€² , y , yâ€² âŸ© ]âŸ¨ p , Î” â†‘ p , q , Î” â†‘ q âŸ©
                    â‰ˆâŸ¨ subst-inváµ¥ (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) (P-compat special c) âŸ©
                [ c Â· [ P ]âŸ¨ x , xâ€² , y , yâ€² âŸ© ]âŸ¨ p , Î” â†‘ p , q , Î” â†‘ q âŸ©
                    â‰ˆâŸ¨âŸ©
                c Â· [ [ P ]âŸ¨ x , xâ€² , y , yâ€² âŸ© ]âŸ¨ p , Î” â†‘ p , q , Î” â†‘ q âŸ©
                    â‰¡âŸ¨ cong (_Â·_ c) (subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) (_ âˆ· _ âˆ· _ âˆ· _ âˆ· [])) âŸ©
                c Â· [ P ]âŸ¨ p , Î” â†‘ p , q , Î” â†‘ q âŸ©
                    â‰ˆâŸ¨âŸ©
                Î” â†‘ (c Â· p * q)
            âˆ where open EqP
        go (*-Â·-distrib c d p) = *-Â·-distrib c d (Î” â†‘ p)
        go (+-cong Î±â‰ˆÎ² Î±â‰ˆÎ²â‚) = +-cong (go Î±â‰ˆÎ²) (go Î±â‰ˆÎ²â‚)
        go {Î² = Î²} (+-zeroÊ³ _) = +-zeroÊ³ (Î” â†‘ Î²)
        go (+-assoc p q r) = +-assoc (Î” â†‘ p) (Î” â†‘ q) (Î” â†‘ r)
        go (+-comm p q) = +-comm (Î” â†‘ p) (Î” â†‘ q)
        go (+-invÊ³ p) = +-invÊ³ (Î” â†‘ p)
        go {Î± = pâ‚€ * qâ‚€} {Î² = pâ‚ * qâ‚} (*-cong pâ‚€â‰ˆpâ‚ qâ‚€â‰ˆqâ‚) =
            begin
                Î” â†‘ (pâ‚€ * qâ‚€)
                    â‰ˆâŸ¨âŸ©
                [ P ]âŸ¨ pâ‚€ , Î” â†‘ pâ‚€ , qâ‚€ , Î” â†‘ qâ‚€ âŸ©
                    â‰ˆâŸ¨ subst-invâ€²áµ¥ P (pâ‚€â‰ˆpâ‚ âˆ·-â‰ˆ go pâ‚€â‰ˆpâ‚ âˆ·-â‰ˆ qâ‚€â‰ˆqâ‚ âˆ·-â‰ˆ go qâ‚€â‰ˆqâ‚ âˆ·-â‰ˆ []-â‰ˆ) âŸ©
                [ P ]âŸ¨ pâ‚ , Î” â†‘ pâ‚ , qâ‚ , Î” â†‘ qâ‚ âŸ©
                    â‰ˆâŸ¨âŸ©
                Î” â†‘ (pâ‚ * qâ‚)
            âˆ where open EqP
        go (*-assoc p q r) =
            begin
                Î” â†‘ ((p * q) * r)
                    â‰ˆâŸ¨âŸ©
                [ P ]âŸ¨ p * q , [ P ]âŸ¨ p , Î” â†‘ p , q , Î” â†‘ q âŸ© , r , Î” â†‘ r âŸ©
                    â‰ˆâŸ¨ subst-invâ€²áµ¥ P (â‰ˆ-refl âˆ·-â‰ˆ â‰¡â†’â‰ˆ (subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) (_ âˆ· _ âˆ· _ âˆ· _ âˆ· _ âˆ· _ âˆ· [])) âˆ·-â‰ˆ â‰ˆ-refl âˆ·-â‰ˆ â‰ˆ-refl âˆ·-â‰ˆ []-â‰ˆ) âŸ¨
                [ P ]âŸ¨ [ x * y ]áµ¥ Ï± , [ [ P ]âŸ¨ x , xâ€² , y , yâ€² âŸ© ]áµ¥ Ï± , [ z ]áµ¥ Ï± , [ zâ€² ]áµ¥ Ï± âŸ©
                    â‰¡âŸ¨ subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) Ï± âŸ¨
                [ [ P ]âŸ¨ x * y , [ P ]âŸ¨ x , xâ€² , y , yâ€² âŸ© ,  z , zâ€² âŸ© ]áµ¥ Ï±
                    â‰ˆâŸ¨ subst-inváµ¥ (_ âˆ· _ âˆ· _ âˆ· _ âˆ· _ âˆ· _ âˆ· []) (P-assoc special) âŸ©
                [ [ P ]âŸ¨ x , xâ€² , y * z , [ P ]âŸ¨ y , yâ€² , z , zâ€² âŸ© âŸ© ]áµ¥ Ï±
                    â‰¡âŸ¨ subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) Ï± âŸ©
                [ P ]âŸ¨ [ x ]áµ¥ Ï± , [ xâ€² ]áµ¥ Ï± , [ y * z ]áµ¥ Ï± , [ [ P ]âŸ¨ y , yâ€² , z , zâ€² âŸ© ]áµ¥ Ï± âŸ©
                    â‰ˆâŸ¨ subst-invâ€²áµ¥ P (â‰ˆ-refl âˆ·-â‰ˆ â‰ˆ-refl âˆ·-â‰ˆ â‰ˆ-refl âˆ·-â‰ˆ â‰¡â†’â‰ˆ (subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) (_ âˆ· _ âˆ· _ âˆ· _ âˆ· _ âˆ· _ âˆ· [])) âˆ·-â‰ˆ []-â‰ˆ) âŸ©
                [ P ]âŸ¨ p , Î” â†‘ p , q * r , [ P ]âŸ¨ q , Î” â†‘ q , r , Î” â†‘ r âŸ© âŸ©
                    â‰ˆâŸ¨âŸ©
                Î” â†‘ (p * (q * r))
            âˆ where            
                open EqP
                Ï± = p âˆ· Î” â†‘ p âˆ· q âˆ· Î” â†‘ q âˆ· r âˆ· Î” â†‘ r âˆ· []

        go (*-comm p q) =
            begin
                Î” â†‘ (p * q)
                    â‰ˆâŸ¨âŸ©
                [ P ]âŸ¨ p , Î” â†‘ p , q , Î” â†‘ q âŸ©
                    â‰¡âŸ¨ subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) âŸ¨
                [ [ P ]âŸ¨ x , xâ€² , y , yâ€² âŸ© ]âŸ¨ p , Î” â†‘ p , q , Î” â†‘ q âŸ©
                    â‰ˆâŸ¨ subst-inváµ¥ (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) (P-comm special) âŸ©
                [ [ P ]âŸ¨ y , yâ€² , x , xâ€² âŸ© ]âŸ¨ p , Î” â†‘ p , q , Î” â†‘ q âŸ©
                    â‰¡âŸ¨ subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) âŸ©
                [ P ]âŸ¨ q , Î” â†‘ q , p , Î” â†‘ p âŸ©
                    â‰ˆâŸ¨âŸ©
                Î” â†‘ (q * p)
            âˆ where open EqP

        go (*-distribÊ³ r p q) =
            let Ï± = p âˆ· Î” â†‘ p âˆ· q âˆ· Î” â†‘ q âˆ· r âˆ· Î” â†‘ r âˆ· [] in
            begin
                Î” â†‘ ((p + q) * r)
                    â‰ˆâŸ¨âŸ©
                [ P ]âŸ¨ p + q , Î” â†‘ p + Î” â†‘ q , r , Î” â†‘ r âŸ©
                    â‰ˆâŸ¨âŸ©
                [ P ]âŸ¨ [ x + y ]áµ¥ Ï± , [ xâ€² + yâ€² ]áµ¥ Ï± , [ z ]áµ¥ Ï± , [ zâ€² ]áµ¥ Ï± âŸ©
                    â‰¡âŸ¨ subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) Ï± âŸ¨
                [ [ P ]âŸ¨ x + y , xâ€² + yâ€² , z , zâ€² âŸ© ]áµ¥ Ï±
                    â‰ˆâŸ¨ subst-inváµ¥ (_ âˆ· _ âˆ· _ âˆ· _ âˆ· _ âˆ· _ âˆ· []) (P-distr special) âŸ©
                [ [ P ]âŸ¨ x , xâ€² , z , zâ€² âŸ© + [ P ]âŸ¨ y , yâ€² , z , zâ€² âŸ© ]áµ¥ Ï±
                    â‰ˆâŸ¨âŸ©
                [ [ P ]âŸ¨ x , xâ€² , z , zâ€² âŸ© ]áµ¥ Ï± + [ [ P ]âŸ¨ y , yâ€² , z , zâ€² âŸ© ]áµ¥ Ï±
                    â‰¡âŸ¨ congâ‚‚ _+_ (subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) Ï±) (subst-substáµ¥ P (_ âˆ· _ âˆ· _ âˆ· _ âˆ· []) Ï±) âŸ©
                [ P ]âŸ¨ p , Î” â†‘ p , r , Î” â†‘ r âŸ© + [ P ]âŸ¨ q , Î” â†‘ q , r , Î” â†‘ r âŸ©
                    â‰ˆâŸ¨âŸ©
                Î” â†‘ (p * r + q * r)
            âˆ where open EqP
```
